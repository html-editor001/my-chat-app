<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Peer Chat(Medical Sciences)</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        
        :root {
            --bg-color: #e5ddd5;
            --header-color: #075e54;
            --bubble-sent: #dcf8c6;
            --bubble-received: #ffffff;
            --text-color: #000000;
            --input-bg: #f0f0f0;
        }

        [data-theme="dark"] {
            --bg-color: #0b141a;
            --header-color: #202c33;
            --bubble-sent: #005c4b;
            --bubble-received: #202c33;
            --text-color: #e9edef;
            --input-bg: #2a3942;
        }
/* ... (Keep previous root variables) ... */

header { 
        background: var(--header-color); 
        color: white; padding: 12px 15px; 
        display: flex; justify-content: space-between; align-items: center;
        backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .user-meta {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    #user-info { font-size: 14px; letter-spacing: 0.5px; }

    /* The Styled Online Badge */
    #online-count { 
        font-size: 11px; 
        background: rgba(255, 255, 255, 0.2); /* Subtle glass look */
        color: #afffd5; /* Bright mint for visibility */
        padding: 2px 10px; 
        border-radius: 20px; 
        display: inline-block;
        width: fit-content;
        font-weight: bold;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
/* Focus Rule for the Input Box */
#input:focus {
    border: 2px solid #128c7e; /* WhatsApp Green */
    background: white;
    padding-left: 20px;
    box-shadow: 0 0 8px rgba(18, 140, 126, 0.3);
}

/* Typing Indicator Styling */
.typing-text {
    font-style: italic;
    color: #afffd5;
    animation: blink 1.5s infinite;
}

@keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}
    [data-theme="dark"] #online-count {
        background: #128c7e;
        color: white;
    }
        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.3s, color 0.3s; }
        
        body { 
            font-family: -apple-system, sans-serif; 
            background-color: var(--bg-color);
            background-image: url("https://www.transparenttextures.com/patterns/cubes.png");
            display: flex; flex-direction: column; height: 100vh; 
            color: var(--text-color);
        }

        header { 
            background: var(--header-color); 
            color: white; padding: 10px 15px; 
            display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000;
        }

        .controls { display: flex; gap: 10px; align-items: center; }

        #messages { flex: 1; list-style-type: none; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; }

        li { max-width: 75%; padding: 8px 12px; margin-bottom: 10px; border-radius: 10px; font-size: 15px; box-shadow: 0 1px 1px rgba(0,0,0,0.1); color: black; }
        [data-theme="dark"] li { color: white; }

        .sent { align-self: flex-end; background-color: var(--bubble-sent); border-bottom-right-radius: 0; }
        .received { align-self: flex-start; background-color: var(--bubble-received); border-bottom-left-radius: 0; }
        
        .name-label { font-size: 11px; font-weight: bold; display: block; margin-bottom: 2px; opacity: 0.7; }

        #form-container { background: var(--input-bg); padding: 15px; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border: none; border-radius: 25px; outline: none; background: white; }
        [data-theme="dark"] input { background: #3b4a54; color: white; }

        button { border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: bold; }
        .btn-send { background: #128c7e; color: white; }
        .btn-clear { background: #ea4335; color: white; }
        .btn-theme { background: #fbbc05; color: black; }
    </style>
</head>
<body>
    <style>
        /* ... (Keep your previous CSS variables and styles) ... */
    
        .controls { display: flex; gap: 8px; align-items: center; }
    
        /* Styling the SVG buttons */
        .icon-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }
    
        .btn-theme { background: rgba(255, 255, 255, 0.15); fill: white; }
        .btn-theme:hover { background: rgba(255, 255, 255, 0.25); }
    
        .btn-clear { background: rgba(234, 67, 53, 0.2); fill: #ff9e9e; }
        .btn-clear:hover { background: rgba(234, 67, 53, 0.4); }
    
        svg { width: 20px; height: 20px; }
    </style>
    
    <body>
    
        <header>
            <div class="user-meta">
                <div id="user-info"><b>You:</b> <span id="my-name">...</span></div>
                <div id="online-count">0 Online</div>
            </div>
            <div class="controls">
                <button class="icon-btn btn-theme" onclick="toggleTheme()" title="Toggle Theme">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m0-12.728l.707.707m11.314 11.314l.707.707M12 8a4 4 0 100 8 4 4 0 000-8z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
                    </svg>
                </button>
                
                <button class="icon-btn btn-clear" onclick="clearLocalChat()" title="Clear Local History">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2m-6 5v6m4-6v6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>
    
     

    <ul id="messages"></ul>

    <div id="form-container">
        <input id="input" autocomplete="off" placeholder="Type a message..." />
        <button class="btn-send" onclick="send()">Send</button>
    </div>

    <script>
        var socket = io();
        
        // 1. Setup User & Theme
        let userName = localStorage.getItem('chatUsername') || "User" + Math.random().toString(36).substring(7);
        localStorage.setItem('chatUsername', userName);
        document.getElementById('my-name').innerText = userName;

        if (localStorage.getItem('theme') === 'dark') document.body.setAttribute('data-theme', 'dark');

        // 2. Load History
        const loadHistory = () => {
            const history = JSON.parse(localStorage.getItem('chatHistory')) || [];
            document.getElementById('messages').innerHTML = '';
            history.forEach(msg => displayMessage(msg));
        };
        loadHistory();

        function toggleTheme() {
            const current = document.body.getAttribute('data-theme');
            const target = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', target);
            localStorage.setItem('theme', target);
        }

        function clearLocalChat() {
            if(confirm("Delete your local copy of the chat?")) {
                localStorage.removeItem('chatHistory');
                document.getElementById('messages').innerHTML = '';
            }
        }

        function send() {
            const input = document.getElementById('input');
            if (input.value) {
                const data = { text: input.value, name: userName, id: socket.id };
                socket.emit('chat message', data);
                input.value = '';
            }
        }

        socket.on('chat message', function(data) {
            displayMessage(data);
            const history = JSON.parse(localStorage.getItem('chatHistory')) || [];
            history.push(data);
            localStorage.setItem('chatHistory', JSON.stringify(history));
        });

        socket.on('user count', count => document.getElementById('online-count').innerText = count + " Online");

        function displayMessage(data) {
            const item = document.createElement('li');
            const isMe = (data.name === userName);
            item.className = isMe ? 'sent' : 'received';
            item.innerHTML = `<span class="name-label">${data.name}</span>${data.text}`;
            document.getElementById('messages').appendChild(item);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }
        /*const input = document.getElementById('input');
const onlineBadge = document.getElementById('online-count');
let typingTimeout;

// 1. Send "Typing" status to server
input.addEventListener('keypress', () => {
    socket.emit('typing', { name: userName, isTyping: true });
    
    // Stop showing "typing" after 2 seconds of no keys
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => {
        socket.emit('typing', { name: userName, isTyping: false });
    }, 2000);
});

// 2. Listen for other users typing
socket.on('typing', (data) => {
    const originalText = onlineBadge.getAttribute('data-count') || "Online";
    if (data.isTyping) {
        onlineBadge.innerHTML = `<span class="typing-text">${data.name} is typing...</span>`;
    } else {
        // Reset to user count
        socket.emit('request count'); // Optional: just refresh count
    }
});

// Update the user count listener to save the "default" state
socket.on('user count', count => {
    const text = count + " Online";
    onlineBadge.setAttribute('data-count', text);
    onlineBadge.innerText = text;
});*/
        document.getElementById('input').addEventListener("keypress", (e) => { if(e.key === "Enter") send(); });
    </script>
</body>
</html>
